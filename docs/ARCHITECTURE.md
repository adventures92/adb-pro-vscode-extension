# Architecture Overview

This document provides a high-level overview of the ADB Pro for VS Code extension. It is intended for developers who want to understand the codebase and contribute to the project.

## High-Level Design

The extension is built using the [Visual Studio Code Extension API](https://code.visualstudio.com/api). It interacts with the Android Debug Bridge (ADB) command-line tool to manage connected devices and perform various actions.

### Core Components

1.  **`extension.ts`**: The entry point of the extension. It handles:
    *   Activation and deactivation.
    *   Registration of commands (e.g., `adb-pro.connect`, `adb-pro.installApk`).
    *   Initialization of the `DeviceTreeProvider`.

2.  **`adbClient.ts`**: A wrapper class around the `adb` CLI. It is responsible for:
    *   Executing shell commands using `child_process`.
    *   Parsing the output from ADB.
    *   Handling errors and timeouts.
    *   Providing a clean API for other components to interact with ADB (e.g., `getConnectedDevices()`, `installApk()`).

3.  **`deviceTreeProvider.ts`**: Implements the `vscode.TreeDataProvider` interface. It manages the "Devices & Apps" view in the sidebar.
    *   Fetches the list of connected devices from `AdbClient`.
    *   Renders the tree view with devices and their status.
    *   Handles interactions with tree items (e.g., clicking a button on a device item).

4.  **`adbWebview.ts`** (If applicable): Manages the Webview-based control panel.
    *   Communicates with the extension host using message passing.
    *   Provides a rich UI for complex interactions (if any).

## Data Flow

1.  **User Action**: The user clicks a button in the sidebar or runs a command from the Command Palette.
2.  **Command Handler**: The corresponding command handler in `extension.ts` is triggered.
3.  **ADB Client**: The handler calls a method on the `AdbClient` instance.
4.  **Shell Execution**: `AdbClient` constructs the appropriate `adb` command and executes it using `child_process.exec` or `spawn`.
5.  **Response Parsing**: The output from the shell command is parsed and returned to the handler.
6.  **UI Update**: The handler updates the UI (e.g., shows a notification, refreshes the tree view) based on the result.

## Key Concepts

### Device State
The extension tracks the state of connected devices (e.g., `device`, `offline`, `unauthorized`). This state is updated periodically or when the user manually refreshes the list.

### Asynchronous Operations
All interactions with ADB are asynchronous. The extension uses `async/await` to handle these operations without blocking the UI thread.

## Directory Structure

*   `src/`: Source code.
    *   `extension.ts`: Main entry point.
    *   `adbClient.ts`: ADB wrapper.
    *   `deviceTreeProvider.ts`: Sidebar logic.
*   `resources/`: Icons and other static assets.
*   `out/`: Compiled JavaScript code (generated by TypeScript).
*   `test/`: Unit and integration tests.
